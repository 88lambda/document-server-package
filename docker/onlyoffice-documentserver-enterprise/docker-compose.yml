version: '2'
services:
  onlyoffice-document:
    container_name: onlyoffice-document
    image: onlyoffice/4testing-documentserver-enterp:3.8.1-6-origin-release-3.8.1
    depends_on:
      - onlyoffice-mysql
      - onlyoffice-redis
      - onlyoffice-rabbitmq
    environment:
      - MYSQL_SERVER_HOST=onlyoffice-mysql
      - MYSQL_SERVER_PORT=3306
      - MYSQL_SERVER_DB_NAME=onlyoffice
      - MYSQL_SERVER_USER=root
      - RABBITMQ_SERVER_HOST=onlyoffice-rabbitmq
      - RABBITMQ_SERVER_USER=guest
      - RABBITMQ_SERVER_PASS=guest
      - REDIS_SERVER_HOST=onlyoffice-redis
      - REDIS_SERVER_PORT=6379
    stdin_open: true
    tty: true
    restart: always
    networks:
      - onlyoffice
    expose:
      - '80'
      - '443'
    volumes:
       - document_data:/var/www/onlyoffice/Data
       - document_log:/var/log/onlyoffice

  onlyoffice-redis:
    container_name: onlyoffice-redis
    image: redis
    restart: always
    networks:
     - onlyoffice
    expose:
      - '6379'

  onlyoffice-rabbitmq:
    container_name: onlyoffice-rabbitmq
    image: rabbitmq
    restart: always
    networks:
     - onlyoffice
    expose:
      - '5672'

  onlyoffice-mysql:
    container_name: onlyoffice-mysql
    image: mysql:5.5
    environment:
      - MYSQL_DATABASE=onlyoffice
      - MYSQL_USER=root
      - MYSQL_ALLOW_EMPTY_PASSWORD='true'
    networks:
      - onlyoffice
    restart: always
    expose:
      - '3306'
    volumes:
      - mysql_data:/var/lib/mysql

networks:
  onlyoffice:
    driver: 'bridge'

volumes:
  mysql_data:
  document_data:
  document_log: